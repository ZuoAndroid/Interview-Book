---
layout: post
title: 爬虫Scrapy框架详解
categories: 爬虫
description: 爬虫Scrapy框架详解
keywords: 爬虫
---
# 爬虫Scrapy框架详解

## 1. 概述
下图显示了 Scrapy 的大体架构，其中包含了它的主要组件及系统的数据处理流程（绿色箭头所示）。下面就来一个个解释每个组件的作用及数据的处理过程。

![](./images/scrapy.jpg)

## 2. 组件

### 2.1 Scrapy Engine （Scrapy 引擎）

Scrapy 引擎是用来控制整个系统的数据处理流程，并进行事务处理的触发。更多的详细内容可以看下面的数据处理流程。

### 2.2 Scheduler （调度）

调度程序从 Scrapy 引擎接受请求并排序列入队列，并在 Scrapy 引擎发出请求后返还给他们。

### 2.3 Downloader （下载器）

下载器的主要职责是抓取网页并将网页内容返还给蜘蛛  ( Spiders )。

### 2.4 Spiders （蜘蛛）

蜘蛛是有 Scrapy 用户自己定义用来解析网页并抓取制定 URL 返回的内容的类，每个蜘蛛都能处理一个域名或一组域名。换句话说就是用来定义特定网站的抓取和解析规则。

蜘蛛的整个抓取流程（周期）是这样的：

首先获取第一个 URL 的初始请求，当请求返回后调取一个回调函数。第一个请求是通过调用 ```start_requests()```方法。该方法默认从``` start_urls ```中的 ``` Url ```中生成请求，并执行解析来调用回调函数。
在回调函数中，你可以解析网页响应并返回项目对象和请求对象或两者的迭代。这些请求也将包含一个回调，然后被``` Scrapy ```下载，然后有指定的回调处理。
在回调函数中，你解析网站的内容，同程使用的是``` Xpath ```选择器（但是你也可以使用``` BeautifuSoup ```,``` lxml ```或其他任何你喜欢的程序），并生成解析的数据项。
最后，从蜘蛛返回的项目通常会进驻到项目管道。
